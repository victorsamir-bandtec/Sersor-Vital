<!doctype html>
<html>

<head>
	<title>Line Chart</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment.min.js"></script>
	<script src="http://www.chartjs.org/dist/2.7.1/Chart.js"></script>
	<script src="http://www.chartjs.org/samples/latest/utils.js"></script>
	<link rel="stylesheet" href="/css/dash.css">
</head>

<body>

	<header class="header">
		<a href="#" class="logo">Sensor Vital<span>Seu medicamento na temperatura ideal</span></a>
		<nav class="menu">
			<ul>
				<li><a href="#Home">Home</a></li>
				<li><a href="#simulador">Orçamento</a></li>
				<li><a href="#Sobre">Sobre nós</a></li>
				<li><a href="login.html">Login</a></li>
			</ul>
		</nav>
	</header>



	<main>
		<div class="container">
			<div class="estrutura">


				<div>
					<canvas id="grafico"></canvas>
				</div>


				<aside class="alas">

					<ul>
						<li><a href=""> UTI </a></li>
						<li><a href=""> Sala cirungica </a></li>
						<li><a href=""> Consultorio </a></li>
						<li><a href=""> Hall </a></li>
					</ul>

				</aside>

			</div>
		</div>

	</main>

	<footer>
		<p>Sensor Vital © 2012 - 2020. Alguns direitos reservados.</p>
	</footer>

</body>

</html>


<script>

	var context = document.getElementById("grafico").getContext("2d");
	// context.canvas.width = 1000;
	// context.canvas.height = 300;

	var configuration = {
		type: 'line',
		data: {
			datasets: [{
				label: 'Temperatura',
				borderColor: 'red',
				backgroundColor: 'red',
				fill: false,
			}]
		},
		options: {

			title: {
				display: true,
				text: 'UTI',

				position: 'top',
				padding: 10,

				fontFamily: 'Poppins',
				fontSize: 60,
				fontColor: 'black',
				fontStyle: 'bold',
			},
			tooltips: {
				mode: 'index',
				intersect: false,
			},
			hover: {
				mode: 'nearest',
				intersect: true
			},

			scales: {
				xAxes: [{
					//type: 'value',
					distribution: 'series',
					ticks: {
						beginAtZero: true
					}
				}],
				yAxes: [{
					scaleLabel: {
						display: true,
						labelString: 'ºC',
						padding: 10,
					},
					ticks: {
						beginAtZero: false,
					}
				}]
			},
			animation: {
				onProgress: null,
				easing: 'linear',
				duration: 10
			}
		}
	};

	var chart = new Chart(context, configuration);

	this.lastIndexTemp = 0;
	this.time = 0;

	function get_data() {

		var http = new XMLHttpRequest();
		http.open('GET', 'http://localhost:3000/api', false);
		http.send(null);

		var obj = JSON.parse(http.responseText);
		console.log(obj)
		if (obj.data.length == 0) {
			return;
		}

		var _lastIndexTemp = this.lastIndexTemp;
		this.lastIndexTemp = obj.data.length;
		listTemp = obj.data.slice(_lastIndexTemp);

		listTemp.forEach(data => {
			//Máximo de 60 itens exibidos no gráfico
			if (chart.data.labels.length == 5 && chart.data.datasets[0].data.length == 5) {
				chart.data.labels.shift();
				chart.data.datasets[0].data.shift();
			}

			chart.data.labels.push(this.time++);
			chart.data.datasets[0].data.push(parseFloat(data));
			chart.update();
		});

	}

	get_data();

	setInterval(() => {
		// var agora = new Date();
		// var hora = agora.getHours();
		// var minuto = agora.getMinutes();
		// var segundo = agora.getSeconds();
		// var momento = `${hora > 9 ? '' : '0'}${hora}:${minuto > 9 ? '' : '0'}${minuto}:${segundo > 9 ? '' : '0'}${segundo}`;

		// var novoRegistro = {
		// 	momento: momento,
		// 	leitura: get_data(),
		// };

		// chart.data.labels.shift(); // apagar o primeiro
		// chart.data.labels.push(novoRegistro.momento); // incluir um novo momento
		// chart.data.datasets[0].data.shift();  // apagar o primeiro
		// chart.data.datasets[0].data.push(novoRegistro.leitura); // incluir uma nova leitura

		// chart.update();

		get_data();

	}, 5000);

</script>